---
title: 事务的四大隔离
tags:
  - 事务
categories:
  - - 学习
    - 事务
    - 事务四大隔离
copyright: true
description: 分析事务隔离级别及解决的问题
date: 2019-12-20 15:05:43
---

参考文件：
[并发事务导致的丢失更新及处理方式详解](https://blog.csdn.net/qq_39445473/article/details/90488673)
[Mysql 事务隔离级别(图文详解)](https://www.cnblogs.com/iwenwen/p/11052206.html)
# 事务的四大隔离
隔离性：事务之间不互相干扰，但是由于访问同一数据源，则必然有干扰，所以需要通过锁机制保证事务隔离性
## 并发事务所会引起的问题
- 针对读操作
    1.脏读：两个事务运行中，其中事务一读取到了事务二修改但是并未提交的操作结果
    |时间|事务一|事务二|
    |-|-|-|
    |T1|开启事务|开启事务|
    |T2|查询账户余额为100|查询账户余额为100|
    |T3||修改账户余额为99|
    |T4|<font color=red face="黑体">查询账户余额为99</font>||
    |T5|提交事务|提交事务|
    
    注：`T4时间，事务一读取到了事务二没有提交的变更`
    2.不可重复读：指在一个事务内多次读同一数据。在这个事务还没有结束时，另一个事务也访问该数据并且做了修改提交了事务，则先前的事务再次获取同一数据，结果却发生了变化。这就出现了一个事务内多次读取数据不一样的不可重复现象。
    |时间|事务一|事务二|
    |-|-|-|
    |T1|开启事务|开启事务|
    |T2|查询账户余额为100|查询账户余额为100|
    |T3||修改账户余额为99|
    |T4||提交事务|
    |T5|<font color=red face="黑体">查询账户余额为99</font>||
    |T6|提交事务||
    
    注：`T5时间，事务一读取到了事务二提交的变更，T2和T5两个时间事务一访问同样资源得到的结果不一样`
    3.幻读：与`不可重复读`类似，只是`不可重复读`重点放在了数据的修改上，也就是数据内容的变化，而`幻读`重点是在新增和删除，也就是数据数量的变化
- 针对写操作
    4.丢失修改：
    1.回滚丢失：指两个事务访问同一数据源，其中一个事务修改内容并提交成功，但是另一个事务失败回滚到了事务最开始的数据，覆盖了成功事务的修改操作
    |时间|事务一|事务二|
    |-|-|-|
    |T1|开启事务|开启事务|
    |T2|查询账户余额为100|查询账户余额为100|
    |T3|修改账户余额为97|修改账户余额为99|
    |T4|提交事务失败并回滚|提交事务成功|
    |T5|<font color=red face="黑体">账户余额恢复到100</font>||
        
    注：`T5时间，事务一失败回滚到了事务一开启时的余额100，覆盖了事务二成功的99余额。`
    <font color=red face="黑体">目前所有的隔离界别都不允许这一类丢失发生。</font>
    2.覆盖丢失：指两个事务访问同一数据源，后成功的修改事务覆盖了先成功的修改事务，导致先修改的事务丢失。
    |时间|事务一|事务二|
    |-|-|-|
    |T1|开启事务|开启事务|
    |T2|查询账户余额为100|查询账户余额为100|
    |T3|修改账户余额-3为97|修改账户余额-1为99|
    |T4||提交事务成功|
    |T5|提交事务成功||
    |T6|<font color=red face="黑体">账户余额为97</font>||
    
    注：`T6时间，事务一的97覆盖了事务二的99，正常操作应该是96=100-1(事务二)-3(事务一)。`
    
## 针对各种读冲突操作问题衍生的四种隔离级别
- READ-UNCOMMITTED（读取未提交）：允许读取尚未提交事务的变更信息。（只要改了就能看到）
- READ-COMMITTED（读取已提交）：允许读取已经提交事务的变更信息。（只要提交就能看到）
- REPEATABLE-READ（可重复读）：在同一事务内的读取结果只会受当前事务的修改影响，幻读仍有可能发生。（事务独立不受其他任何事务影响，幻读除外）
- SERIALIZABLE（可串行化）：所有事务依次逐个执行，完全不互相干扰。
|隔离级别|脏读|不可重复读|幻读|
|-|-|-|-|
|READ-UNCOMMITTED|√|√|√|
|READ-COMMITTED|×|√|√|
|REPEATABLE-READ|×|×|√|
|SERIALIZABLE|×|×|×|

## 针对写操作冲突问题的处理方案
引入锁的机制对资源进行限制

    
